
<source>
  @type forward
  port 24224 
</source>

<source>
 @type tail
 path /var/log/ammobin.log
 pos_file /fluentd/log/ammobin.log.pos
 tag ammobin.caddylog
 <parse>
   @type nginx
 </parse>
</source>

<filter **.caddylog.**>
  @type ua_parser
  key_name user
</filter>

<match ammobin.**>
  @type elasticsearch
  host "#{ENV['ES_URL']}"
  port 443 
  user "#{ENV['ES_USER']}"
  password "#{ENV['ES_PASSWORD']}"
  scheme https
  ssl_version TLSv1_2 
  include_timestamp true
  logstash_format true
  logstash_prefix ammobin-${tag}
  verify_es_version_at_startup true
  default_elasticsearch_version 6

  <buffer>
    @type file
    path /fluentd/log/buffer
  </buffer>
</match>
